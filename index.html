<script>
    let allMerchants = [];

    function cleanText(text) {
        if (!text) return "";
        return text.replace(/[أإآ]/g, 'ا').replace(/ة/g, 'ه').toLowerCase().trim();
    }

    async function loadMerchants() {
        try {
            const response = await fetch('merchants.json');
            allMerchants = await response.json();
            displayMerchants(allMerchants);
        } catch (e) { console.error("Error loading JSON"); }
    }

    function displayMerchants(data) {
        const container = document.getElementById('merchants-container');
        let html = '';
        data.forEach(m => {
            html += `
                <div class="merchant-card">
                    <img src="${m.image}" class="merchant-img">
                    <div class="merchant-info">
                        <span class="badge">موثوق GCV</span>
                        <h3 style="margin:0;">${m.name}</h3>
                        <p style="color:#666; margin:5px 0;">${m.category}</p>
                        <p style="color:#888; font-size:13px;"><i class="fas fa-map-marker-alt"></i> ${m.location}</p>
                        <div style="color: #ffc107;">★ ★ ★ ★ ★ (${m.rating})</div>
                        <button style="width:100%; margin-top:10px; background:var(--main-purple); color:white; border:none; padding:10px; border-radius:8px;">عرض التفاصيل</button>
                    </div>
                </div>`;
        });
        container.innerHTML = html;
    }

    function filterSearch() {
        const query = cleanText(document.getElementById('searchInput').value);
        const filtered = allMerchants.filter(m => 
            cleanText(m.name).includes(query) || 
            cleanText(m.category).includes(query)
        );
        displayMerchants(filtered);
    }
    window.onload = loadMerchants;
            </script>
